<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>萬聖節的魔法起源：小惠與老師的古老傳說</title><style> :root { --primary-color: #3b82f6; } body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #111827; margin: 0; padding: 1rem; display: flex; flex-direction: column; align-items: center; min-height: 100vh; box-sizing: border-box; } .main-container { max-width: 1100px; width: 100%; } .storybook-wrapper { margin-bottom: 1rem; } #storybook-view { display: flex; justify-content: center; align-items: center; } .storybook-cover { position: relative; width: 100%; max-width: 550px; aspect-ratio: 1 / 1; background-color: #eee; border-radius: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.1), 0 3px 6px rgba(0,0,0,0.1); overflow: hidden; display: flex; align-items: flex-end; justify-content: center; } .storybook-cover img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; } .cover-info-card { position: relative; width: 100%; padding: 1.5rem; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-top: 1px solid rgba(255, 255, 255, 0.3); text-align: center; } .cover-info-card h1 { font-size: 2em; margin: 0 0 0.25em 0; line-height: 1.2; color: #1f2937; } .cover-info-card h2 { font-size: 1.25em; margin: 0 0 0.75em 0; font-weight: normal; color: #374151; } .cover-info-card p { font-size: 0.9em; margin: 0; color: #4b5563; } .storybook-spread { display: flex; gap: 1rem; width: 100%; aspect-ratio: 2 / 1; } .image-pane { width: 50%; aspect-ratio: 1/1; position: relative; background-color: #eee; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; } .image-pane img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; } .text-pane { width: 50%; aspect-ratio: 1/1; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 2rem; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; position: relative; } .story-text-container { } .text-block { position: relative; } .text-zh { font-size: 1.4em; margin-bottom: 1.5em; line-height: 1.7; color: #1f2937; } .text-en { font-size: 1.1em; line-height: 1.6; color: #4b5563; } .play-button { position: absolute; top: 0; right: -10px; cursor: pointer; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; } .play-button:hover { background: #e5e7eb; } .play-button.playing { background-color: var(--primary-color); color: white; border-color: var(--primary-color); } .page-number { position: absolute; bottom: 1.5rem; right: 1.5rem; font-size: 0.9em; color: #9ca3af; } .controls { width: 100%; padding: 1rem; background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; } .nav-buttons, .tool-buttons { display: flex; align-items: center; gap: 0.5rem; } .controls button, .controls label { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; border: 1px solid #d1d5db; border-radius: 6px; background-color: #fff; color: #374151; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s, box-shadow 0.2s; } .controls button:hover:not(:disabled) { background-color: #f9fafb; } .controls button:disabled { opacity: 0.5; cursor: not-allowed; } #page-indicator { font-weight: 500; color: #4b5563; min-width: 80px; text-align: center; } .lang-selector button.active, .speed-selector button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); } .speed-selector { display: inline-flex; } .speed-selector button { border-radius: 0; border-right-width: 0; padding: 0.5rem 0.75rem; } .speed-selector button:first-child { border-top-left-radius: 6px; border-bottom-left-radius: 6px; } .speed-selector button:last-child { border-top-right-radius: 6px; border-bottom-right-radius: 6px; border-right-width: 1px; } .autoplay-label { user-select: none; } .autoplay-label input { margin-right: 0.5rem; } @media (max-width: 768px) { body { padding: 0.5rem; } .storybook-spread { flex-direction: column; aspect-ratio: auto; } .image-pane, .text-pane { width: 100%; } .controls { flex-direction: column; } .cover-info-card h1 { font-size: 1.8em; } .cover-info-card h2 { font-size: 1.1em; } .text-zh { font-size: 1.2em; } .text-en { font-size: 1em; } } </style></head><body><div class="main-container"><div class="storybook-wrapper"><div id="storybook-view"></div></div><div class="controls"><div class="nav-buttons"><button id="prev-btn">&larr; Previous</button><span id="page-indicator"></span><button id="next-btn">Next &rarr;</button></div><div class="tool-buttons"><div class="lang-selector" id="lang-selector"><button id="lang-zh-btn">中文</button><button id="lang-bilingual-btn" class="active">雙語</button><button id="lang-en-btn">English</button></div><div class="speed-selector" id="speed-selector"><button data-rate="0.75">0.75x</button><button data-rate="1.0" class="active">1x</button><button data-rate="1.25">1.25x</button><button data-rate="1.5">1.5x</button></div><label class="autoplay-label"><input type="checkbox" id="autoplay-toggle" /> 自動播放 </label></div></div></div><script> document.addEventListener('DOMContentLoaded', () => { const storyData = {"cover":{"title_zh":"萬聖節的魔法起源：小惠與老師的古老傳說","title_en":"The Magical Origin of Halloween: Leona and Teacher Star's Ancient Tale","image_prompt":"An epic, cinematic cover art of two cute chibi vinyl dolls, Leona and Teacher Star, both in detailed Halloween costumes. Leona, a Nendoroid-style chibi doll, wears a charming witch costume with a pointed hat, a flowing dark purple cape, and holds a miniature broomstick. Her medium brown bob hair with an ahoge is visible under the hat, and her large, round, deep purple eyes behind round black-rimmed glasses sparkle with curiosity. Teacher Star, also a Nendoroid-style chibi doll, is dressed as a wise wizard in a deep blue robe, a tall pointed hat adorned with stars, and holds a mystical staff. His stylish, layered black hair with spiked ends is visible, and his large, bright brown eyes have a confident, slightly playful gaze. They are standing amidst a swirling, enchanted autumn forest at twilight, with ancient, glowing Celtic symbols subtly integrated into the gnarled trees and misty ground. A massive, intricately carved Jack-o'-lantern emits a warm, magical glow in the foreground. The background is a stunning, detailed blend of mystical fog, glowing harvest moon, and ethereal spirits dancing amongst ancient standing stones. The overall style is a 3D render, photorealistic, with a premium, high-quality matte vinyl finish and bright, clean, high-key studio lighting, creating a captivating, diorama-style scene with incredible depth.","imageUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAIAAADwf7zUAAAgAElEQVR4AVT923rcypK1aUoiJa2Vfx30Yd const foreignLanguageInfo = {"name":"English","ttsCode":"en-US","voiceName":"Puck"}; let currentPageIndex = -1; let isAutoplayOn = false; let languageView = 'bilingual'; let speechRate = 1.0; let audioContext; let activeSource = null; let activeBtnElement = null; const storybookView = document.getElementById('storybook-view'); const prevBtn = document.getElementById('prev-btn'); const nextBtn = document.getElementById('next-btn'); const pageIndicator = document.getElementById('page-indicator'); const autoplayToggle = document.getElementById('autoplay-toggle'); const langSelector = document.getElementById('lang-selector'); const speedSelector = document.getElementById('speed-selector'); const playIconSvg = '<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" /></svg>'; const pauseIconSvg = '<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75v-7.5m-5.25 7.5v-7.5" /></svg>'; const decodeBase64 = (base64) => { const binaryString = atob(base64); const len = binaryString.length; const bytes = new Uint8Array(len); for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); } return bytes; }; async function decodePcmAudioData(data, ctx) { const dataInt16 = new Int16Array(data.buffer, data.byteOffset, data.length / 2); const frameCount = dataInt16.length; const buffer = ctx.createBuffer(1, frameCount, 24000); const channelData = buffer.getChannelData(0); for (let i = 0; i < frameCount; i++) { channelData[i] = dataInt16[i] / 32768.0; } return buffer; } function initAudioContext() { if (!audioContext) { audioContext = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 24000 }); } } function stopAudio() { if (activeSource) { activeSource.onended = null; try { activeSource.stop(); } catch(e) {} activeSource = null; } if (activeBtnElement) { activeBtnElement.classList.remove('playing'); activeBtnElement.innerHTML = playIconSvg; activeBtnElement = null; } } async function playAudio(lang, pageIndex, buttonElement) { initAudioContext(); if (activeBtnElement === buttonElement) { stopAudio(); return; } stopAudio(); const page = storyData.pages[pageIndex]; const audioBase64 = lang === 'zh' ? page.audio_zh : page.audio_en; if (!audioBase64) { console.error('Audio data not found for', lang, 'on page', pageIndex); alert('Sorry, the audio for this part could not be loaded.'); return; } try { buttonElement.innerHTML = pauseIconSvg; buttonElement.classList.add('playing'); activeBtnElement = buttonElement; const pcmData = decodeBase64(audioBase64); const audioBuffer = await decodePcmAudioData(pcmData, audioContext); const source = audioContext.createBufferSource(); source.buffer = audioBuffer; source.playbackRate.value = lang === 'zh' ? speechRate * 0.85 : speechRate; source.connect(audioContext.destination); source.start(); source.onended = () => { if (activeSource === source) { stopAudio(); if (isAutoplayOn && currentPageIndex < storyData.pages.length - 1) { renderPage(currentPageIndex + 1); } } }; activeSource = source; } catch (error) { console.error("Error playing audio:", error); stopAudio(); } } function updateControls() { prevBtn.disabled = currentPageIndex <= -1; nextBtn.disabled = currentPageIndex >= storyData.pages.length - 1; pageIndicator.textContent = currentPageIndex === -1 ? 'Cover' : `Page ${currentPageIndex + 1} / ${storyData.pages.length}`; } function renderPage(index) { stopAudio(); currentPageIndex = index; const isCover = index === -1; const data = isCover ? storyData.cover : storyData.pages[index]; let pageHtml = ''; if (isCover) { pageHtml = ` <div class="storybook-cover"><img src="${data.imageUrl}" alt="${data.image_prompt}"><div class="cover-info-card"><h1 class="title-zh">${data.title_zh}</h1><h2 class="title-en">${data.title_en}</h2><p>作者 : TZU HUI CHIEN</p></div></div> `; } else { pageHtml = ` <div class="storybook-spread"><div class="image-pane"><img src="${data.imageUrl}" alt="${data.image_prompt}"></div><div class="text-pane"><div class="story-text-container"><div class="text-block text-zh"><p>${data.text}</p><button class="play-button" id="play-zh-${index}">${playIconSvg}</button></div><div class="text-block text-en"><p>${data.text_en}</p><button class="play-button" id="play-en-${index}">${playIconSvg}</button></div></div><div class="page-number">${index + 1}</div></div></div> `; } storybookView.innerHTML = pageHtml; updateLanguageView(); updateControls(); if (isAutoplayOn && !isCover) { setTimeout(() => { const langToPlay = languageView === 'en' ? 'en' : 'zh'; const btn = document.getElementById(`play-${langToPlay}-${index}`); if (btn) btn.click(); }, 500); } } function updateLanguageView() { const zhElements = document.querySelectorAll('.text-zh, .title-zh'); const enElements = document.querySelectorAll('.text-en, .title-en'); zhElements.forEach(el => el.style.display = (languageView === 'en' ? 'none' : '')); enElements.forEach(el => el.style.display = (languageView === 'zh' ? 'none' : '')); langSelector.querySelectorAll('button').forEach(btn => btn.classList.remove('active')); document.getElementById(`lang-${languageView}-btn`).classList.add('active'); } prevBtn.addEventListener('click', () => renderPage(currentPageIndex - 1)); nextBtn.addEventListener('click', () => renderPage(currentPageIndex + 1)); autoplayToggle.addEventListener('change', (e) => { isAutoplayOn = e.target.checked; if (!isAutoplayOn) stopAudio(); }); langSelector.addEventListener('click', (e) => { if (e.target.tagName === 'BUTTON') { if (e.target.id.includes('zh')) languageView = 'zh'; else if (e.target.id.includes('bilingual')) languageView = 'bilingual'; else if (e.target.id.includes('en')) languageView = 'en'; updateLanguageView(); } }); speedSelector.addEventListener('click', (e) => { const button = e.target.closest('button'); if (button && button.dataset.rate) { speechRate = parseFloat(button.dataset.rate); speedSelector.querySelectorAll('button').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); } }); storybookView.addEventListener('click', (e) => { const button = e.target.closest('.play-button'); if (button) { const idParts = button.id.split('-'); const lang = idParts[1]; const pageIndex = parseInt(idParts[2], 10); playAudio(lang, pageIndex, button); } }); renderPage(-1); }); </script></body></html>
